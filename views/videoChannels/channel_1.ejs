<!--ejs partial no head or body here-->

<!--views/videoChannels/channel_1.ejs-->
<!--This is where the overlay goes, the connected client should automatically receive the played video here-->
<div class="index-card">
<div class="client_window">
  <div class="myVideo">
  <h2 id="statusText">ðŸ“º  New videos here daily!</h2>
</div>
</div>
<div style="color:red" id="marqueeContainer">
  <marquee id="marqueeText" behavior="scroll" direction="left" style="display: none;"></marquee>
</div>
</div>
<script src="/socket.io/socket.io.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const socket = io('/main_chat');

    socket.on('connect', () => {
      console.log('Connected to channel_1 client');
    });

    socket.on('connect_error', (err) => {
      console.error('Connection error:', err);
    });
    socket.on('broadcast', (videoUrl) => {
      const finUrl = videoUrl.videoUrl.videoUrl;
      console.log(`CHANNEL ONE BROADCAST NOTICED url: ${finUrl}`);
      const containerVid = document.querySelector('.myVideo');
      const statusText = document.getElementById('statusText');
      statusText.style.display = 'none'; // Hide the "Awaiting Update..." text
     
      containerVid.innerHTML += `
        <video autoplay id="videoPlayer" repeat autoplay style="max-height:200px;width: 100%;">
          <source src="https://${finUrl}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      `;
    });
    socket.on('broadcast',(videoUrl)=>{
      const finUrl = videoUrl.videoUrl.videoUrl
      console.log(`CHANNEL ONE BROADCAST NOTICED url:${finUrl}`)
    
    })
    
    socket.on('marquee', (data) => {
      console.log('Received marquee message:', data.message);
      const marqueeText = document.getElementById('marqueeText');
      marqueeText.innerText = data.message;
      marqueeText.style.display = 'block'; // Show the marquee
    });
    
    document.addEventListener('click', (event) => {
      if(event.target.classList.contains('play-video')){
        const videoUrl=event.target.getAttribute('data-video')
        console.log(`playVIDDDSS!!k ${videoUrl}`)
        socket.emit('broadcast',{videoUrl:videoUrl})
      }
    });
    document.addEventListener('click', (event) => {
      if (event.target.classList.contains('marqueeButton')) {
        const marqueeMessage = document.getElementById('marqueeMessage').value;
        console.log('Button clicked', marqueeMessage);
        socket.emit('marquee', { message: marqueeMessage });
        console.log('Marquee event emitted');
 
      
      }
    });
  });

</script>
